<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VLCafe Admin - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        body {
            touch-action: manipulation;
            overscroll-behavior-y: none;
        }
        .sidebar { 
            width: 250px; 
            transition: all 0.3s;
            height: 100vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .content { 
            margin-left: 250px; 
            transition: all 0.3s;
            min-height: 100vh;
        }
        .sidebar-collapsed .sidebar { width: 70px; }
        .sidebar-collapsed .content { margin-left: 70px; }
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                transform: translateX(-100%);
                position: fixed;
                z-index: 100;
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            .content {
                margin-left: 0;
                width: 100%;
            }
            .sidebar-collapsed .sidebar {
                width: 70px;
                transform: translateX(0);
            }
            .sidebar-collapsed .content {
                margin-left: 0;
            }
            .stat-card, .stat-card-2, .stat-card-3, .stat-card-4 {
                padding: 1rem !important;
            }
            .text-3xl {
                font-size: 1.5rem !important;
            }
            .text-5xl {
                font-size: 2.5rem !important;
            }
            .p-6 {
                padding: 1rem !important;
            }
            .grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            .grid-cols-4 {
                grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
            }
            .lg\:grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            .md\:grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
        }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .queue-pulse { animation: queuePulse 2s infinite; }
        @keyframes queuePulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #92400e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .mobile-menu-btn {
            display: none;
        }
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
            .sidebar-toggle {
                display: none;
            }
        }
        /* Better touch targets for mobile */
        button, 
        a.nav-item, 
        input[type="text"],
        input[type="email"],
        input[type="password"],
        select {
            min-height: 44px;
        }
        .nav-item {
            padding: 12px 16px;
        }
        /* Prevent zoom on input focus iOS */
        @media screen and (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }
        /* Better scroll for mobile */
        .mobile-scroll {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-auto mobile-scroll" style="max-height: 90vh; overflow-y: auto;">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-amber-700 rounded-lg flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-mug-hot text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">VLCafe Admin</h2>
                <p class="text-gray-600 mt-2">Masuk ke dashboard admin</p>
            </div>
            
            <!-- Demo Credentials -->
            <div id="demoCredentials" class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg mb-4">
                <div class="flex items-start">
                    <i class="fas fa-info-circle mt-0.5 mr-3"></i>
                    <div>
                        <p class="font-medium">Credentials Demo</p>
                        <p class="text-sm mt-1">Email: <span class="font-mono">admin@vlcafe.com</span></p>
                        <p class="text-sm">Password: <span class="font-mono">admin123</span></p>
                        <p class="text-xs mt-2 text-blue-600">*Gunakan credentials ini untuk testing</p>
                    </div>
                </div>
            </div>
            
            <!-- Pesan Error Login -->
            <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-circle mt-0.5 mr-3"></i>
                    <div>
                        <p class="font-medium" id="errorTitle">Terjadi kesalahan</p>
                        <p class="text-sm mt-1" id="errorMessage">Email atau password salah</p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition text-base" placeholder="admin@email.com" value="admin@vlcafe.com">
                    <p id="emailError" class="hidden text-xs text-red-500 mt-1"></p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition text-base" placeholder="••••••••" value="admin123">
                    <p id="passwordError" class="hidden text-xs text-red-500 mt-1"></p>
                </div>
                
                <button id="loginBtn" class="w-full py-4 bg-amber-700 text-white rounded-lg font-medium hover:bg-amber-800 active:bg-amber-900 transition flex items-center justify-center relative touch-manipulation">
                    <span id="loginBtnText">
                        <i class="fas fa-sign-in-alt mr-2"></i> Masuk
                    </span>
                    <div id="loginLoader" class="loader absolute hidden"></div>
                </button>
                
                <div class="text-center mt-4">
                    <button onclick="testFirebaseConnection()" class="text-sm text-amber-600 hover:text-amber-800 py-2 px-3">
                        <i class="fas fa-plug mr-1"></i> Test Koneksi
                    </button>
                </div>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-200">
                <p class="text-xs text-gray-500 text-center">
                    Pastikan koneksi internet stabil. Jika gagal, coba refresh halaman.
                </p>
            </div>
        </div>
    </div>

    <!-- Main Layout (Hidden until login) -->
    <div id="mainLayout" class="hidden">
        <!-- Mobile Menu Button -->
        <button id="mobileMenuBtn" class="mobile-menu-btn fixed top-4 left-4 z-50 bg-amber-700 text-white p-3 rounded-lg shadow-lg">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar -->
        <div class="sidebar fixed left-0 top-0 h-full bg-gray-900 text-white z-40">
            <div class="p-6 border-b border-gray-800">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-amber-700 rounded-lg flex items-center justify-center">
                            <i class="fas fa-mug-hot text-white text-xl"></i>
                        </div>
                        <div class="hidden md:block">
                            <h2 class="text-xl font-bold">VLCafe</h2>
                            <p class="text-xs text-gray-400">Admin Panel</p>
                        </div>
                    </div>
                    <button id="toggleSidebar" class="sidebar-toggle text-gray-400 hover:text-white p-2">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button id="closeSidebar" class="mobile-menu-btn text-gray-400 hover:text-white p-2 md:hidden">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <nav class="p-4 space-y-2 mobile-scroll" style="height: calc(100vh - 140px);">
                <a href="#" class="nav-item active flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition" data-page="dashboard">
                    <i class="fas fa-tachometer-alt w-6 text-center"></i>
                    <span class="hidden md:inline">Dashboard</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition" data-page="queue">
                    <i class="fas fa-list-ol w-6 text-center"></i>
                    <span class="hidden md:inline">Manage Antrian</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition" data-page="orders">
                    <i class="fas fa-receipt w-6 text-center"></i>
                    <span class="hidden md:inline">Manage Order</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition" data-page="products">
                    <i class="fas fa-utensils w-6 text-center"></i>
                    <span class="hidden md:inline">Manage Produk</span>
                </a>
                <a href="#" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-800 transition" data-page="reports">
                    <i class="fas fa-chart-bar w-6 text-center"></i>
                    <span class="hidden md:inline">Laporan</span>
                </a>
            </nav>
            
            <div class="absolute bottom-0 w-full p-4 border-t border-gray-800">
                <button id="logoutBtn" class="flex items-center space-x-3 text-gray-400 hover:text-white w-full p-3 rounded-lg hover:bg-gray-800 transition">
                    <i class="fas fa-sign-out-alt w-6"></i>
                    <span class="hidden md:inline">Keluar</span>
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="content min-h-screen">
            <!-- Top Bar -->
            <header class="sticky top-0 z-30 bg-white shadow-sm">
                <div class="flex justify-between items-center px-4 py-3 md:px-6 md:py-4">
                    <div>
                        <h1 class="text-lg md:text-xl font-bold text-gray-900" id="pageTitle">Dashboard</h1>
                        <p class="text-xs md:text-sm text-gray-600" id="pageSubtitle">Ringkasan sistem VLCafe</p>
                    </div>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <div class="text-right">
                            <p class="font-medium text-sm md:text-base" id="adminName">Admin</p>
                            <p class="text-xs text-gray-500" id="currentTime">--:--:--</p>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Page Content -->
            <main class="p-4 md:p-6">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                        <div class="stat-card text-white rounded-xl p-4 md:p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs md:text-sm opacity-90">Order Hari Ini</p>
                                    <p class="text-xl md:text-3xl font-bold mt-2" id="todayOrders">0</p>
                                </div>
                                <i class="fas fa-shopping-cart text-lg md:text-2xl opacity-70"></i>
                            </div>
                            <p class="text-xs md:text-sm mt-3 md:mt-4 opacity-90" id="todayRevenue">Revenue: Rp 0</p>
                        </div>
                        
                        <div class="stat-card-2 text-white rounded-xl p-4 md:p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs md:text-sm opacity-90">Antrian Aktif</p>
                                    <p class="text-xl md:text-3xl font-bold mt-2" id="activeQueue">0</p>
                                </div>
                                <i class="fas fa-users text-lg md:text-2xl opacity-70"></i>
                            </div>
                            <p class="text-xs md:text-sm mt-3 md:mt-4 opacity-90" id="waitingQueue">Menunggu: 0</p>
                        </div>
                        
                        <div class="stat-card-3 text-white rounded-xl p-4 md:p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs md:text-sm opacity-90">Total Produk</p>
                                    <p class="text-xl md:text-3xl font-bold mt-2" id="totalProducts">0</p>
                                </div>
                                <i class="fas fa-utensils text-lg md:text-2xl opacity-70"></i>
                            </div>
                            <p class="text-xs md:text-sm mt-3 md:mt-4 opacity-90" id="availableProducts">Tersedia: 0</p>
                        </div>
                        
                        <div class="stat-card-4 text-white rounded-xl p-4 md:p-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs md:text-sm opacity-90">Total Revenue</p>
                                    <p class="text-xl md:text-3xl font-bold mt-2" id="totalRevenue">Rp 0</p>
                                </div>
                                <i class="fas fa-chart-line text-lg md:text-2xl opacity-70"></i>
                            </div>
                            <p class="text-xs md:text-sm mt-3 md:mt-4 opacity-90">All time</p>
                        </div>
                    </div>
                    
                    <!-- Current Queue & Recent Orders -->
                    <div class="grid lg:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
                        <!-- Current Queue -->
                        <div class="bg-white rounded-xl shadow p-4 md:p-6">
                            <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 md:mb-6 gap-3">
                                <h3 class="text-base md:text-lg font-bold text-gray-900">Antrian Sekarang</h3>
                                <div class="flex space-x-2">
                                    <button id="testVoiceBtn" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200 transition touch-manipulation">
                                        <i class="fas fa-volume-up"></i> <span class="hidden md:inline">Test</span>
                                    </button>
                                    <button id="callNextBtn" class="px-3 py-2 bg-amber-700 text-white rounded-lg text-sm hover:bg-amber-800 transition touch-manipulation">
                                        <i class="fas fa-forward"></i> <span class="hidden md:inline">Panggil Berikutnya</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="text-center p-4 md:p-8 bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl mb-4 md:mb-6 queue-pulse">
                                <p class="text-xs md:text-sm text-amber-700 mb-2">Sedang Dipanggil</p>
                                <p class="text-3xl md:text-5xl font-bold text-amber-900 mb-3" id="currentQueueNumber">---</p>
                                <div class="inline-block px-3 py-1 md:px-4 md:py-1 bg-amber-200 text-amber-900 rounded-full text-xs md:text-sm font-medium">
                                    <span id="currentQueueStatus">TIDAK ADA</span>
                                </div>
                            </div>
                            
                            <h4 class="font-medium text-gray-900 mb-3">Antrian Menunggu</h4>
                            <div class="space-y-3 max-h-48 md:max-h-60 overflow-y-auto mobile-scroll" id="waitingQueueList">
                                <div class="text-center py-6 text-gray-400">
                                    <i class="fas fa-clock text-xl md:text-2xl mb-2 opacity-30"></i>
                                    <p class="text-sm">Tidak ada antrian menunggu</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Orders -->
                        <div class="bg-white rounded-xl shadow p-4 md:p-6">
                            <h3 class="text-base md:text-lg font-bold text-gray-900 mb-4 md:mb-6">Order Terbaru</h3>
                            <div class="space-y-3 max-h-64 md:max-h-96 overflow-y-auto mobile-scroll" id="recentOrders">
                                <div class="text-center py-8 text-gray-400">
                                    <i class="fas fa-receipt text-xl md:text-2xl mb-2 opacity-30"></i>
                                    <p class="text-sm">Belum ada order</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="bg-white rounded-xl shadow p-4 md:p-6">
                        <h3 class="text-base md:text-lg font-bold text-gray-900 mb-4 md:mb-6">Aksi Cepat</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                            <button onclick="showPage('products')" class="p-3 md:p-4 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 active:bg-blue-200 transition flex flex-col items-center touch-manipulation">
                                <i class="fas fa-plus-circle text-lg md:text-xl mb-2"></i>
                                <span class="text-xs md:text-sm font-medium">Tambah Produk</span>
                            </button>
                            <button onclick="clearCompletedQueue()" class="p-3 md:p-4 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 active:bg-green-200 transition flex flex-col items-center touch-manipulation">
                                <i class="fas fa-check-circle text-lg md:text-xl mb-2"></i>
                                <span class="text-xs md:text-sm font-medium">Clear Selesai</span>
                            </button>
                            <button onclick="resetTodayQueue()" class="p-3 md:p-4 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 active:bg-red-200 transition flex flex-col items-center touch-manipulation">
                                <i class="fas fa-redo text-lg md:text-xl mb-2"></i>
                                <span class="text-xs md:text-sm font-medium">Reset Antrian</span>
                            </button>
                            <button onclick="generateReport()" class="p-3 md:p-4 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 active:bg-purple-200 transition flex flex-col items-center touch-manipulation">
                                <i class="fas fa-download text-lg md:text-xl mb-2"></i>
                                <span class="text-xs md:text-sm font-medium">Export Laporan</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Queue Management Page -->
                <div id="queuePage" class="page-content hidden">
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-4 md:p-6 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-3">
                                <div>
                                    <h2 class="text-lg md:text-xl font-bold text-gray-900">Manage Antrian</h2>
                                    <p class="text-xs md:text-sm text-gray-600">Kelola antrian pesanan pelanggan</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button id="resetAllQueue" class="px-3 py-2 md:px-4 md:py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 active:bg-red-300 transition text-sm touch-manipulation">
                                        <i class="fas fa-trash-alt mr-1 md:mr-2"></i> Reset All
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 md:p-6">
                            <div class="grid md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                                <div class="bg-amber-50 rounded-xl p-4 md:p-6">
                                    <div class="flex justify-between items-center mb-3 md:mb-4">
                                        <h4 class="font-bold text-amber-900 text-sm md:text-base">Sedang Dipanggil</h4>
                                        <span class="text-xl md:text-2xl font-bold text-amber-900" id="adminCurrentQueue">---</span>
                                    </div>
                                    <button onclick="callNextQueueAdmin()" class="w-full py-2 md:py-2 bg-amber-700 text-white rounded-lg hover:bg-amber-800 active:bg-amber-900 transition touch-manipulation">
                                        <i class="fas fa-forward mr-1 md:mr-2"></i> Panggil Berikutnya
                                    </button>
                                </div>
                                
                                <div class="bg-blue-50 rounded-xl p-4 md:p-6">
                                    <h4 class="font-bold text-blue-900 text-sm md:text-base mb-3 md:mb-4">Status Antrian</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-blue-700 text-sm">Menunggu</span>
                                            <span class="font-bold" id="queueWaitingCount">0</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-green-700 text-sm">Selesai</span>
                                            <span class="font-bold" id="queueDoneCount">0</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-700 text-sm">Total</span>
                                            <span class="font-bold" id="queueTotalCount">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-green-50 rounded-xl p-4 md:p-6">
                                    <h4 class="font-bold text-green-900 text-sm md:text-base mb-3 md:mb-4">Aksi Cepat</h4>
                                    <div class="space-y-2 md:space-y-3">
                                        <button onclick="markAllAsDone()" class="w-full py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 active:bg-green-300 transition text-xs md:text-sm touch-manipulation">
                                            <i class="fas fa-check mr-1 md:mr-2"></i> Tandai Semua Selesai
                                        </button>
                                        <button onclick="testVoiceAnnouncement()" class="w-full py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 active:bg-blue-300 transition text-xs md:text-sm touch-manipulation">
                                            <i class="fas fa-volume-up mr-1 md:mr-2"></i> Test Suara
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto mobile-scroll">
                                <table class="w-full min-w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">No Antrian</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Order ID</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Items</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Total</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Waktu</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Status</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="queueTable">
                                        <tr>
                                            <td colspan="7" class="py-8 text-center text-gray-400">
                                                <i class="fas fa-list-ol text-xl md:text-2xl mb-2 opacity-30"></i>
                                                <p class="text-sm">Tidak ada data antrian</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Orders Management Page -->
                <div id="ordersPage" class="page-content hidden">
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-4 md:p-6 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-3">
                                <div>
                                    <h2 class="text-lg md:text-xl font-bold text-gray-900">Manage Order</h2>
                                    <p class="text-xs md:text-sm text-gray-600">Lihat dan kelola semua order pelanggan</p>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-3">
                                    <div class="relative">
                                        <input type="text" id="searchOrder" placeholder="Cari order..." class="w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-sm">
                                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                    <select id="orderFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-sm">
                                        <option value="all">Semua Status</option>
                                        <option value="waiting">Menunggu</option>
                                        <option value="in-progress">Diproses</option>
                                        <option value="done">Selesai</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 md:p-6">
                            <div class="mb-4 md:mb-6">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 text-center">
                                    <div class="p-3 md:p-4 bg-amber-50 rounded-lg">
                                        <p class="text-xs md:text-sm text-amber-700">Total Order</p>
                                        <p class="text-lg md:text-2xl font-bold text-amber-900" id="totalOrdersCount">0</p>
                                    </div>
                                    <div class="p-3 md:p-4 bg-blue-50 rounded-lg">
                                        <p class="text-xs md:text-sm text-blue-700">Hari Ini</p>
                                        <p class="text-lg md:text-2xl font-bold text-blue-900" id="todayOrdersCount">0</p>
                                    </div>
                                    <div class="p-3 md:p-4 bg-green-50 rounded-lg">
                                        <p class="text-xs md:text-sm text-green-700">Revenue Hari Ini</p>
                                        <p class="text-lg md:text-2xl font-bold text-green-900" id="todayRevenueCount">Rp 0</p>
                                    </div>
                                    <div class="p-3 md:p-4 bg-purple-50 rounded-lg">
                                        <p class="text-xs md:text-sm text-purple-700">Avg. Order</p>
                                        <p class="text-lg md:text-2xl font-bold text-purple-900" id="avgOrderValue">Rp 0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto mobile-scroll">
                                <table class="w-full min-w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Order ID</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">No Antrian</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Items</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Total</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Waktu</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Status</th>
                                            <th class="text-left py-3 px-2 md:px-4 text-xs md:text-sm font-medium text-gray-700">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersTable">
                                        <tr>
                                            <td colspan="7" class="py-8 text-center text-gray-400">
                                                <i class="fas fa-receipt text-xl md:text-2xl mb-2 opacity-30"></i>
                                                <p class="text-sm">Tidak ada data order</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Products Management Page -->
                <div id="productsPage" class="page-content hidden">
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-4 md:p-6 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-3">
                                <div>
                                    <h2 class="text-lg md:text-xl font-bold text-gray-900">Manage Produk</h2>
                                    <p class="text-xs md:text-sm text-gray-600">Kelola menu produk VLCafe</p>
                                </div>
                                <button onclick="showAddProductModal()" class="px-3 py-2 md:px-4 md:py-2 bg-amber-700 text-white rounded-lg hover:bg-amber-800 active:bg-amber-900 transition touch-manipulation">
                                    <i class="fas fa-plus mr-1 md:mr-2"></i> Tambah Produk
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4 md:p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6" id="productsGrid">
                                <div class="col-span-full text-center py-12">
                                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-700 mx-auto mb-4"></div>
                                    <p class="text-gray-500">Memuat produk...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Page -->
                <div id="reportsPage" class="page-content hidden">
                    <div class="bg-white rounded-xl shadow">
                        <div class="p-4 md:p-6 border-b border-gray-200">
                            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-3">
                                <div>
                                    <h2 class="text-lg md:text-xl font-bold text-gray-900">Laporan</h2>
                                    <p class="text-xs md:text-sm text-gray-600">Analisis data penjualan dan antrian</p>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-3">
                                    <select id="reportPeriod" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-sm">
                                        <option value="today">Hari Ini</option>
                                        <option value="week">Minggu Ini</option>
                                        <option value="month">Bulan Ini</option>
                                        <option value="all">Semua</option>
                                    </select>
                                    <button onclick="exportReport()" class="px-3 py-2 md:px-4 md:py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 active:bg-green-800 transition touch-manipulation">
                                        <i class="fas fa-download mr-1 md:mr-2"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 md:p-6">
                            <div class="grid lg:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8">
                                <div class="bg-gray-50 rounded-xl p-4 md:p-6">
                                    <h3 class="font-bold text-gray-900 text-sm md:text-base mb-3 md:mb-4">Ringkasan Penjualan</h3>
                                    <div class="space-y-3 md:space-y-4" id="salesSummary">
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Total Order</span>
                                            <span class="font-bold" id="reportTotalOrders">0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Total Revenue</span>
                                            <span class="font-bold text-green-600" id="reportTotalRevenue">Rp 0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Rata-rata per Order</span>
                                            <span class="font-bold" id="reportAvgOrder">Rp 0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Produk Terlaris</span>
                                            <span class="font-bold" id="reportBestSeller">-</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 rounded-xl p-4 md:p-6">
                                    <h3 class="font-bold text-gray-900 text-sm md:text-base mb-3 md:mb-4">Statistik Antrian</h3>
                                    <div class="space-y-3 md:space-y-4" id="queueStats">
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Total Antrian</span>
                                            <span class="font-bold" id="reportTotalQueue">0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Waktu Tunggu Rata-rata</span>
                                            <span class="font-bold" id="reportAvgWaitTime">0 menit</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Antrian Tertinggi</span>
                                            <span class="font-bold" id="reportMaxQueue">0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 text-sm">Efisiensi</span>
                                            <span class="font-bold text-green-600" id="reportEfficiency">0%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 rounded-xl p-4 md:p-6">
                                <h3 class="font-bold text-gray-900 text-sm md:text-base mb-3 md:mb-4">Order Terbaru</h3>
                                <div class="overflow-x-auto mobile-scroll">
                                    <table class="w-full min-w-full">
                                        <thead>
                                            <tr class="border-b border-gray-200">
                                                <th class="text-left py-2 text-xs md:text-sm font-medium text-gray-700">Order ID</th>
                                                <th class="text-left py-2 text-xs md:text-sm font-medium text-gray-700">Waktu</th>
                                                <th class="text-left py-2 text-xs md:text-sm font-medium text-gray-700">Items</th>
                                                <th class="text-left py-2 text-xs md:text-sm font-medium text-gray-700">Total</th>
                                                <th class="text-left py-2 text-xs md:text-sm font-medium text-gray-700">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="reportOrdersTable">
                                            <tr>
                                                <td colspan="5" class="py-6 text-center text-gray-400">
                                                    Tidak ada data order
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="firestoreTestModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">Test Koneksi Firebase</h3>
                <button onclick="closeFirestoreTest()" class="text-gray-400 hover:text-gray-600 p-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div id="firestoreTestResult" class="p-4 rounded-lg">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-amber-700 mx-auto mb-4"></div>
                    <p class="text-center text-gray-500">Testing koneksi...</p>
                </div>
                
                <button onclick="closeFirestoreTest()" class="w-full py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 active:bg-gray-300 transition touch-manipulation">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-auto mobile-scroll" style="max-height: 90vh;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900" id="productModalTitle">Tambah Produk Baru</h3>
                <button onclick="closeProductModal()" class="text-gray-400 hover:text-gray-600 p-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="productError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4"></div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Produk</label>
                    <input type="text" id="productName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="Contoh: Cappuccino">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                    <select id="productCategory" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        <option value="coffee">Kopi</option>
                        <option value="tea">Teh</option>
                        <option value="food">Makanan</option>
                        <option value="dessert">Dessert</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga (Rp)</label>
                    <input type="number" id="productPrice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="35000" min="0">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                    <textarea id="productDescription" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500" rows="3" placeholder="Deskripsi produk..."></textarea>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="productAvailable" class="w-5 h-5 text-amber-600 border-gray-300 rounded focus:ring-amber-500" checked>
                        <label for="productAvailable" class="ml-2 text-sm text-gray-700">Tersedia</label>
                    </div>
                </div>
                
                <input type="hidden" id="productId">
                
                <div class="flex space-x-3 pt-4">
                    <button onclick="saveProduct()" class="flex-1 py-3 bg-amber-700 text-white rounded-lg font-medium hover:bg-amber-800 active:bg-amber-900 transition touch-manipulation">
                        <i class="fas fa-save mr-2"></i> Simpan
                    </button>
                    <button onclick="closeProductModal()" class="flex-1 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 active:bg-gray-300 transition touch-manipulation">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="orderDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 max-w-2xl w-full mx-auto mobile-scroll" style="max-height: 90vh;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900" id="orderDetailTitle">Detail Order</h3>
                <button onclick="closeOrderDetailModal()" class="text-gray-400 hover:text-gray-600 p-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="orderDetailContent">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA1kevuJ9mRJ8le8uPXin11uUqJ6sOLopY",
            authDomain: "vlcrave-whatsapp-order.firebaseapp.com",
            projectId: "vlcrave-whatsapp-order",
            storageBucket: "vlcrave-whatsapp-order.firebasestorage.app",
            messagingSenderId: "796602954067",
            appId: "1:796602954067:web:e10a110ae904decdc471a6",
            measurementId: "G-XLWNDN39ZD"
        };

        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const mainLayout = document.getElementById('mainLayout');
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const loginBtn = document.getElementById('loginBtn');
        const loginBtnText = document.getElementById('loginBtnText');
        const loginLoader = document.getElementById('loginLoader');
        const loginError = document.getElementById('loginError');
        const errorTitle = document.getElementById('errorTitle');
        const errorMessage = document.getElementById('errorMessage');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');
        const logoutBtn = document.getElementById('logoutBtn');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const closeSidebar = document.getElementById('closeSidebar');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.querySelector('.sidebar');
        const pageTitle = document.getElementById('pageTitle');
        const pageSubtitle = document.getElementById('pageSubtitle');
        const adminName = document.getElementById('adminName');
        const currentTime = document.getElementById('currentTime');

        // App State
        let currentUser = null;
        let db = null;
        let auth = null;
        let firebaseInitialized = false;
        let unsubscribeFunctions = [];
        let currentEditingProductId = null;

        // Initialize Firebase
        function initializeFirebase() {
            try {
                if (!firebase || typeof firebase.initializeApp === 'undefined') {
                    console.error('Firebase SDK not loaded');
                    showLoginError('Firebase Error', 'Firebase SDK tidak dimuat. Periksa koneksi internet.');
                    return;
                }

                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                
                firebaseInitialized = true;
                console.log('Firebase initialized successfully');
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showLoginError('Firebase Error', 'Gagal menginisialisasi Firebase: ' + error.message);
            }
        }

        // Initialize Firebase on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing Firebase...');
            initializeFirebase();
            
            // Check if already logged in
            if (firebaseInitialized) {
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        console.log('User already logged in:', user.email);
                        currentUser = user;
                        loginModal.classList.add('hidden');
                        mainLayout.classList.remove('hidden');
                        initializeAdmin();
                    } else {
                        console.log('No user logged in');
                        loginModal.classList.remove('hidden');
                    }
                });
            }
            
            // Setup mobile menu
            setupMobileMenu();
            
            // Add touch event listeners for better mobile UX
            setupTouchEvents();
        });

        // Setup mobile menu
        function setupMobileMenu() {
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    sidebar.classList.toggle('mobile-open');
                });
            }
            
            if (closeSidebar) {
                closeSidebar.addEventListener('click', function() {
                    sidebar.classList.remove('mobile-open');
                });
            }
            
            // Close sidebar when clicking on nav items on mobile
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('mobile-open');
                    }
                });
            });
        }

        // Setup touch events for better mobile UX
        function setupTouchEvents() {
            // Prevent double tap zoom
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // Add active state to buttons on touch
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.classList.add('active');
                });
                
                button.addEventListener('touchend', function() {
                    this.classList.remove('active');
                });
            });
        }

        // Utility Functions
        function formatRupiah(amount) {
            return 'Rp ' + (amount || 0).toLocaleString('id-ID');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg max-w-sm ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' :
                        type === 'error' ? 'fa-exclamation-circle' :
                        'fa-info-circle'
                    } mr-3"></i>
                    <span class="text-sm">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function generateOrderId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `ORD-${timestamp}-${random}`;
        }

        function generateQueueNumber() {
            const now = new Date();
            const dateStr = now.getDate().toString().padStart(2, '0') + 
                          (now.getMonth() + 1).toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 100).toString().padStart(2, '0');
            return `Q${dateStr}${random}`;
        }

        // Login Error Handling
        function showLoginError(title, message) {
            errorTitle.textContent = title;
            errorMessage.textContent = message;
            loginError.classList.remove('hidden');
            
            setTimeout(() => {
                loginError.classList.add('hidden');
            }, 5000);
        }

        function showFieldError(field, message) {
            if (field === 'email') {
                emailError.textContent = message;
                emailError.classList.remove('hidden');
            } else if (field === 'password') {
                passwordError.textContent = message;
                passwordError.classList.remove('hidden');
            }
        }

        function clearFieldErrors() {
            emailError.classList.add('hidden');
            passwordError.classList.add('hidden');
            loginError.classList.add('hidden');
        }

        // Loader Functions
        function showLoginLoader() {
            loginBtn.disabled = true;
            loginBtnText.classList.add('opacity-0');
            loginLoader.classList.remove('hidden');
            loginBtn.style.cursor = 'not-allowed';
        }

        function hideLoginLoader() {
            loginBtn.disabled = false;
            loginBtnText.classList.remove('opacity-0');
            loginLoader.classList.add('hidden');
            loginBtn.style.cursor = 'pointer';
        }

        // Login Function
        async function login(email, password) {
            console.log('Login attempt for:', email);
            
            try {
                // Check Firebase initialization
                if (!firebaseInitialized) {
                    showLoginError('System Error', 'Firebase belum diinisialisasi. Coba refresh halaman.');
                    return;
                }
                
                // Clear previous errors
                clearFieldErrors();
                
                // Validate form
                if (!email || !password) {
                    showLoginError('Validation Error', 'Email dan password harus diisi');
                    return;
                }
                
                // Show loader
                showLoginLoader();
                
                // Add small delay for better UX on mobile
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Attempt login
                console.log('Attempting Firebase authentication...');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                console.log('Login successful:', currentUser.email);
                showNotification('Login berhasil!', 'success');
                
                // Hide login modal and show main layout
                loginModal.classList.add('hidden');
                mainLayout.classList.remove('hidden');
                
                // Initialize admin dashboard
                await initializeAdmin();
                
            } catch (error) {
                console.error('Login error:', error);
                
                // Handle specific Firebase auth errors
                let errorTitle = 'Login Gagal';
                let errorMessage = 'Terjadi kesalahan saat login';
                
                switch(error.code) {
                    case 'auth/user-not-found':
                        errorTitle = 'Email Tidak Ditemukan';
                        errorMessage = 'Email tidak terdaftar.';
                        break;
                    case 'auth/wrong-password':
                        errorTitle = 'Password Salah';
                        errorMessage = 'Password tidak sesuai.';
                        break;
                    case 'auth/invalid-email':
                        errorTitle = 'Email Tidak Valid';
                        errorMessage = 'Format email tidak valid.';
                        break;
                    case 'auth/network-request-failed':
                        errorTitle = 'Koneksi Gagal';
                        errorMessage = 'Periksa koneksi internet Anda.';
                        break;
                    default:
                        errorMessage = error.message || 'Terjadi kesalahan.';
                        break;
                }
                
                showLoginError(errorTitle, errorMessage);
                
            } finally {
                // Hide loader
                hideLoginLoader();
            }
        }

        // Event Listeners
        loginBtn.addEventListener('click', function(e) {
            console.log('Login button clicked');
            e.preventDefault();
            e.stopPropagation();
            
            const email = loginEmail.value.trim();
            const password = loginPassword.value;
            
            login(email, password);
        });

        // Also handle form submission
        loginEmail.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginBtn.click();
            }
        });

        loginPassword.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginBtn.click();
            }
        });

        // Touch events for mobile
        loginBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.classList.add('active');
        });

        loginBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            this.classList.remove('active');
            const email = loginEmail.value.trim();
            const password = loginPassword.value;
            login(email, password);
        });

        // Clear errors when typing
        loginEmail.addEventListener('input', () => {
            clearFieldErrors();
        });

        loginPassword.addEventListener('input', () => {
            clearFieldErrors();
        });

        // Logout
        logoutBtn.addEventListener('click', logout);

        // Toggle sidebar
        toggleSidebar.addEventListener('click', () => {
            document.body.classList.toggle('sidebar-collapsed');
        });

        // Mobile menu toggle
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });
        }

        if (closeSidebar) {
            closeSidebar.addEventListener('click', () => {
                sidebar.classList.remove('mobile-open');
            });
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const page = item.getAttribute('data-page');
                showPage(page);
            });
        });

        // Page Navigation Function
        function showPage(page) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            // Show selected page
            document.getElementById(`${page}Page`).classList.remove('hidden');
            
            // Add active class to selected nav item
            document.querySelector(`.nav-item[data-page="${page}"]`).classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'queue': 'Manage Antrian',
                'orders': 'Manage Order',
                'products': 'Manage Produk',
                'reports': 'Laporan'
            };
            
            const subtitles = {
                'dashboard': 'Ringkasan sistem VLCafe',
                'queue': 'Kelola antrian pesanan pelanggan',
                'orders': 'Lihat dan kelola semua order pelanggan',
                'products': 'Kelola menu produk VLCafe',
                'reports': 'Analisis data penjualan dan antrian'
            };
            
            pageTitle.textContent = titles[page];
            pageSubtitle.textContent = subtitles[page];
            
            // Load data for the page
            loadPageData(page);
        }

        // Load data for specific page
        function loadPageData(page) {
            switch(page) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'queue':
                    loadQueueData();
                    break;
                case 'orders':
                    loadOrdersData();
                    break;
                case 'products':
                    loadProductsData();
                    break;
                case 'reports':
                    loadReportsData();
                    break;
            }
        }

        // Initialize Admin Dashboard
        async function initializeAdmin() {
            try {
                // Update admin name
                adminName.textContent = currentUser.email.split('@')[0];
                
                // Setup real-time clock
                updateClock();
                setInterval(updateClock, 1000);
                
                // Setup real-time listeners
                setupRealtimeListeners();
                
                // Show dashboard
                showPage('dashboard');
                
                // Show welcome notification
                showNotification(`Selamat datang, ${adminName.textContent}!`, 'success');
                
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('Gagal memuat data', 'error');
            }
        }

        // Setup real-time listeners
        function setupRealtimeListeners() {
            // Clean up previous listeners
            unsubscribeFunctions.forEach(unsub => unsub());
            unsubscribeFunctions = [];
            
            // Listen for queue updates
            const queueUnsub = db.collection('queue')
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    updateQueueDisplay(snapshot);
                    updateDashboardStats(snapshot);
                });
            
            unsubscribeFunctions.push(queueUnsub);
            
            // Listen for orders updates
            const ordersUnsub = db.collection('orders')
                .orderBy('timestamp', 'desc')
                .onSnapshot((snapshot) => {
                    updateOrdersDisplay(snapshot);
                    updateDashboardOrders(snapshot);
                });
            
            unsubscribeFunctions.push(ordersUnsub);
            
            // Listen for products updates
            const productsUnsub = db.collection('products')
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    updateProductsDisplay(snapshot);
                    updateDashboardProducts(snapshot);
                });
            
            unsubscribeFunctions.push(productsUnsub);
        }

        // Update queue display
        function updateQueueDisplay(snapshot) {
            const queueTable = document.getElementById('queueTable');
            const waitingQueueList = document.getElementById('waitingQueueList');
            
            if (snapshot.empty) {
                queueTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="py-8 text-center text-gray-400">
                            <i class="fas fa-list-ol text-xl md:text-2xl mb-2 opacity-30"></i>
                            <p class="text-sm">Tidak ada data antrian</p>
                        </td>
                    </tr>
                `;
                
                waitingQueueList.innerHTML = `
                    <div class="text-center py-6 text-gray-400">
                        <i class="fas fa-clock text-xl md:text-2xl mb-2 opacity-30"></i>
                        <p class="text-sm">Tidak ada antrian menunggu</p>
                    </div>
                `;
                return;
            }
            
            let waitingQueueHTML = '';
            let queueTableHTML = '';
            let waitingCount = 0;
            let doneCount = 0;
            let currentQueue = null;
            
            snapshot.forEach(doc => {
                const queue = doc.data();
                const queueId = doc.id;
                
                if (queue.status === 'called') {
                    currentQueue = queue;
                }
                
                if (queue.status === 'waiting') {
                    waitingCount++;
                    waitingQueueHTML += `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <div>
                                <span class="font-bold text-lg">${queue.queueNumber}</span>
                                <p class="text-xs text-gray-500">${queue.orderId || 'No Order'}</p>
                            </div>
                            <span class="text-sm text-gray-600">${formatTime(queue.createdAt)}</span>
                        </div>
                    `;
                } else if (queue.status === 'done') {
                    doneCount++;
                }
                
                queueTableHTML += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-3 px-2 md:px-4">
                            <span class="font-bold text-gray-900">${queue.queueNumber}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="text-sm font-mono">${queue.orderId || 'N/A'}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="text-sm">${queue.itemsCount || 0} items</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="font-medium">${formatRupiah(queue.totalAmount || 0)}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="text-xs text-gray-500">${formatTime(queue.createdAt)}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                queue.status === 'waiting' ? 'bg-yellow-100 text-yellow-800' :
                                queue.status === 'called' ? 'bg-blue-100 text-blue-800' :
                                'bg-green-100 text-green-800'
                            }">
                                ${getStatusText(queue.status)}
                            </span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <div class="flex space-x-2">
                                ${queue.status === 'waiting' ? `
                                    <button onclick="callQueue('${queueId}')" class="text-blue-600 hover:text-blue-800 p-1">
                                        <i class="fas fa-forward"></i>
                                    </button>
                                ` : ''}
                                ${queue.status === 'called' ? `
                                    <button onclick="markQueueAsDone('${queueId}')" class="text-green-600 hover:text-green-800 p-1">
                                        <i class="fas fa-check"></i>
                                    </button>
                                ` : ''}
                                <button onclick="deleteQueue('${queueId}')" class="text-red-600 hover:text-red-800 p-1">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            // Update waiting queue list
            if (waitingQueueHTML) {
                waitingQueueList.innerHTML = waitingQueueHTML;
            } else {
                waitingQueueList.innerHTML = `
                    <div class="text-center py-6 text-gray-400">
                        <i class="fas fa-clock text-xl md:text-2xl mb-2 opacity-30"></i>
                        <p class="text-sm">Tidak ada antrian menunggu</p>
                    </div>
                `;
            }
            
            // Update queue table
            queueTable.innerHTML = queueTableHTML;
            
            // Update current queue display
            if (currentQueue) {
                document.getElementById('currentQueueNumber').textContent = currentQueue.queueNumber;
                document.getElementById('currentQueueStatus').textContent = 'SEDANG DIPANGGIL';
                document.getElementById('adminCurrentQueue').textContent = currentQueue.queueNumber;
            } else {
                document.getElementById('currentQueueNumber').textContent = '---';
                document.getElementById('currentQueueStatus').textContent = 'TIDAK ADA';
                document.getElementById('adminCurrentQueue').textContent = '---';
            }
            
            // Update queue counts
            document.getElementById('queueWaitingCount').textContent = waitingCount;
            document.getElementById('queueDoneCount').textContent = doneCount;
            document.getElementById('queueTotalCount').textContent = snapshot.size;
            document.getElementById('waitingQueue').textContent = `Menunggu: ${waitingCount}`;
        }

        // Update orders display
        function updateOrdersDisplay(snapshot) {
            const ordersTable = document.getElementById('ordersTable');
            const recentOrders = document.getElementById('recentOrders');
            
            if (snapshot.empty) {
                ordersTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="py-8 text-center text-gray-400">
                            <i class="fas fa-receipt text-xl md:text-2xl mb-2 opacity-30"></i>
                            <p class="text-sm">Tidak ada data order</p>
                        </td>
                    </tr>
                `;
                
                recentOrders.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-receipt text-xl md:text-2xl mb-2 opacity-30"></i>
                        <p class="text-sm">Belum ada order</p>
                    </div>
                `;
                return;
            }
            
            let ordersTableHTML = '';
            let recentOrdersHTML = '';
            let todayOrders = 0;
            let todayRevenue = 0;
            let totalOrders = 0;
            let totalRevenue = 0;
            const today = new Date().toDateString();
            
            snapshot.forEach((doc, index) => {
                const order = doc.data();
                const orderId = doc.id;
                const orderDate = order.timestamp ? order.timestamp.toDate().toDateString() : '';
                
                // Calculate stats
                totalOrders++;
                totalRevenue += order.total || 0;
                
                if (orderDate === today) {
                    todayOrders++;
                    todayRevenue += order.total || 0;
                }
                
                // Orders table row
                ordersTableHTML += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-3 px-2 md:px-4">
                            <span class="text-sm font-mono">${orderId}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="font-bold">${order.queueNumber || 'N/A'}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="text-sm">${order.items ? order.items.length : 0} items</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="font-medium">${formatRupiah(order.total || 0)}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="text-xs text-gray-500">${formatTime(order.timestamp)}</span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                order.status === 'waiting' ? 'bg-yellow-100 text-yellow-800' :
                                order.status === 'in-progress' ? 'bg-blue-100 text-blue-800' :
                                'bg-green-100 text-green-800'
                            }">
                                ${getStatusText(order.status)}
                            </span>
                        </td>
                        <td class="py-3 px-2 md:px-4">
                            <div class="flex space-x-2">
                                <button onclick="viewOrderDetail('${orderId}')" class="text-blue-600 hover:text-blue-800 p-1">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="updateOrderStatus('${orderId}')" class="text-green-600 hover:text-green-800 p-1">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteOrder('${orderId}')" class="text-red-600 hover:text-red-800 p-1">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                
                // Recent orders (only first 5 for dashboard)
                if (index < 5) {
                    recentOrdersHTML += `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <div>
                                <span class="font-medium">${order.queueNumber || 'No Queue'}</span>
                                <p class="text-xs text-gray-500">${orderId.substring(0, 8)}...</p>
                            </div>
                            <div class="text-right">
                                <span class="font-bold">${formatRupiah(order.total || 0)}</span>
                                <p class="text-xs text-gray-500">${formatTime(order.timestamp)}</p>
                            </div>
                        </div>
                    `;
                }
            });
            
            // Update orders table
            ordersTable.innerHTML = ordersTableHTML;
            
            // Update recent orders
            if (recentOrdersHTML) {
                recentOrders.innerHTML = recentOrdersHTML;
            }
            
            // Update order stats
            document.getElementById('todayOrdersCount').textContent = todayOrders;
            document.getElementById('todayRevenueCount').textContent = formatRupiah(todayRevenue);
            document.getElementById('totalOrdersCount').textContent = totalOrders;
            document.getElementById('avgOrderValue').textContent = formatRupiah(totalOrders > 0 ? totalRevenue / totalOrders : 0);
        }

        // Update products display
        function updateProductsDisplay(snapshot) {
            const productsGrid = document.getElementById('productsGrid');
            
            if (snapshot.empty) {
                productsGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-utensils text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Belum ada produk</p>
                        <button onclick="showAddProductModal()" class="mt-4 px-4 py-2 bg-amber-700 text-white rounded-lg hover:bg-amber-800">
                            <i class="fas fa-plus mr-2"></i> Tambah Produk Pertama
                        </button>
                    </div>
                `;
                return;
            }
            
            let productsHTML = '';
            let availableCount = 0;
            let totalCount = 0;
            
            snapshot.forEach(doc => {
                const product = doc.data();
                const productId = doc.id;
                totalCount++;
                
                if (product.available !== false) {
                    availableCount++;
                }
                
                productsHTML += `
                    <div class="bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition">
                        <div class="p-4 md:p-6">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="font-bold text-gray-900 text-lg">${product.name}</h3>
                                    <span class="inline-block px-2 py-1 text-xs font-medium rounded ${
                                        product.category === 'coffee' ? 'bg-amber-100 text-amber-800' :
                                        product.category === 'tea' ? 'bg-green-100 text-green-800' :
                                        product.category === 'food' ? 'bg-red-100 text-red-800' :
                                        'bg-purple-100 text-purple-800'
                                    }">
                                        ${getCategoryText(product.category)}
                                    </span>
                                </div>
                                <span class="font-bold text-lg">${formatRupiah(product.price)}</span>
                            </div>
                            
                            <p class="text-gray-600 text-sm mb-4">${product.description || 'Tidak ada deskripsi'}</p>
                            
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full mr-2 ${
                                        product.available !== false ? 'bg-green-500' : 'bg-red-500'
                                    }"></div>
                                    <span class="text-sm ${
                                        product.available !== false ? 'text-green-700' : 'text-red-700'
                                    }">
                                        ${product.available !== false ? 'Tersedia' : 'Habis'}
                                    </span>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editProduct('${productId}')" class="text-blue-600 hover:text-blue-800 p-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="toggleProductAvailability('${productId}', ${product.available !== false})" class="text-green-600 hover:text-green-800 p-2">
                                        <i class="fas fa-power-off"></i>
                                    </button>
                                    <button onclick="deleteProduct('${productId}')" class="text-red-600 hover:text-red-800 p-2">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            productsGrid.innerHTML = productsHTML;
            
            // Update product counts
            document.getElementById('availableProducts').textContent = `Tersedia: ${availableCount}`;
            document.getElementById('totalProducts').textContent = totalCount;
        }

        // Update dashboard stats
        function updateDashboardStats(snapshot) {
            let activeQueue = 0;
            let waitingQueue = 0;
            
            snapshot.forEach(doc => {
                const queue = doc.data();
                if (queue.status === 'called') {
                    activeQueue++;
                } else if (queue.status === 'waiting') {
                    waitingQueue++;
                }
            });
            
            document.getElementById('activeQueue').textContent = activeQueue;
            document.getElementById('waitingQueue').textContent = `Menunggu: ${waitingQueue}`;
        }

        function updateDashboardOrders(snapshot) {
            const today = new Date().toDateString();
            let todayOrders = 0;
            let todayRevenue = 0;
            let totalRevenue = 0;
            
            snapshot.forEach(doc => {
                const order = doc.data();
                const orderDate = order.timestamp ? order.timestamp.toDate().toDateString() : '';
                
                totalRevenue += order.total || 0;
                
                if (orderDate === today) {
                    todayOrders++;
                    todayRevenue += order.total || 0;
                }
            });
            
            document.getElementById('todayOrders').textContent = todayOrders;
            document.getElementById('todayRevenue').textContent = `Revenue: ${formatRupiah(todayRevenue)}`;
            document.getElementById('totalRevenue').textContent = formatRupiah(totalRevenue);
        }

        function updateDashboardProducts(snapshot) {
            let totalProducts = 0;
            let availableProducts = 0;
            
            snapshot.forEach(doc => {
                const product = doc.data();
                totalProducts++;
                if (product.available !== false) {
                    availableProducts++;
                }
            });
            
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('availableProducts').textContent = `Tersedia: ${availableProducts}`;
        }

        // Helper functions
        function formatTime(timestamp) {
            if (!timestamp) return 'N/A';
            
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getStatusText(status) {
            const statusMap = {
                'waiting': 'Menunggu',
                'called': 'Dipanggil',
                'in-progress': 'Diproses',
                'done': 'Selesai'
            };
            return statusMap[status] || status;
        }

        function getCategoryText(category) {
            const categoryMap = {
                'coffee': 'Kopi',
                'tea': 'Teh',
                'food': 'Makanan',
                'dessert': 'Dessert'
            };
            return categoryMap[category] || category;
        }

        function updateClock() {
            const now = new Date();
            currentTime.textContent = now.toLocaleTimeString('id-ID', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Product CRUD Functions
        function showAddProductModal() {
            currentEditingProductId = null;
            document.getElementById('productModalTitle').textContent = 'Tambah Produk Baru';
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = 'coffee';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productAvailable').checked = true;
            document.getElementById('productId').value = '';
            document.getElementById('productError').classList.add('hidden');
            document.getElementById('productModal').classList.remove('hidden');
        }

        function editProduct(productId) {
            db.collection('products').doc(productId).get()
                .then(doc => {
                    if (doc.exists) {
                        const product = doc.data();
                        currentEditingProductId = productId;
                        
                        document.getElementById('productModalTitle').textContent = 'Edit Produk';
                        document.getElementById('productName').value = product.name || '';
                        document.getElementById('productCategory').value = product.category || 'coffee';
                        document.getElementById('productPrice').value = product.price || '';
                        document.getElementById('productDescription').value = product.description || '';
                        document.getElementById('productAvailable').checked = product.available !== false;
                        document.getElementById('productId').value = productId;
                        document.getElementById('productError').classList.add('hidden');
                        document.getElementById('productModal').classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error getting product:', error);
                    showNotification('Gagal memuat data produk', 'error');
                });
        }

        async function saveProduct() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const price = parseInt(document.getElementById('productPrice').value);
            const description = document.getElementById('productDescription').value.trim();
            const available = document.getElementById('productAvailable').checked;
            const productId = document.getElementById('productId').value;
            
            // Validation
            if (!name) {
                showProductError('Nama produk harus diisi');
                return;
            }
            
            if (!price || price <= 0) {
                showProductError('Harga harus lebih dari 0');
                return;
            }
            
            const productData = {
                name,
                category,
                price,
                description,
                available,
                updatedAt: new Date()
            };
            
            try {
                if (currentEditingProductId) {
                    // Update existing product
                    await db.collection('products').doc(currentEditingProductId).update(productData);
                    showNotification('Produk berhasil diupdate', 'success');
                } else {
                    // Add new product
                    productData.createdAt = new Date();
                    await db.collection('products').add(productData);
                    showNotification('Produk berhasil ditambahkan', 'success');
                }
                
                closeProductModal();
            } catch (error) {
                console.error('Error saving product:', error);
                showNotification('Gagal menyimpan produk', 'error');
            }
        }

        function showProductError(message) {
            const errorDiv = document.getElementById('productError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }

        async function toggleProductAvailability(productId, currentStatus) {
            try {
                await db.collection('products').doc(productId).update({
                    available: !currentStatus,
                    updatedAt: new Date()
                });
                
                showNotification('Status produk berhasil diubah', 'success');
            } catch (error) {
                console.error('Error toggling product availability:', error);
                showNotification('Gagal mengubah status produk', 'error');
            }
        }

        async function deleteProduct(productId) {
            if (!confirm('Apakah Anda yakin ingin menghapus produk ini?')) return;
            
            try {
                await db.collection('products').doc(productId).delete();
                showNotification('Produk berhasil dihapus', 'success');
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('Gagal menghapus produk', 'error');
            }
        }

        // Queue CRUD Functions
        async function callQueue(queueId) {
            try {
                await db.collection('queue').doc(queueId).update({
                    status: 'called',
                    calledAt: new Date()
                });
                
                // Announce queue number
                announceQueueNumber(queueId);
                showNotification('Antrian berhasil dipanggil', 'success');
            } catch (error) {
                console.error('Error calling queue:', error);
                showNotification('Gagal memanggil antrian', 'error');
            }
        }

        async function markQueueAsDone(queueId) {
            try {
                await db.collection('queue').doc(queueId).update({
                    status: 'done',
                    completedAt: new Date()
                });
                
                showNotification('Antrian ditandai selesai', 'success');
            } catch (error) {
                console.error('Error marking queue as done:', error);
                showNotification('Gagal menandai antrian', 'error');
            }
        }

        async function deleteQueue(queueId) {
            if (!confirm('Apakah Anda yakin ingin menghapus antrian ini?')) return;
            
            try {
                await db.collection('queue').doc(queueId).delete();
                showNotification('Antrian berhasil dihapus', 'success');
            } catch (error) {
                console.error('Error deleting queue:', error);
                showNotification('Gagal menghapus antrian', 'error');
            }
        }

        async function markAllAsDone() {
            if (!confirm('Tandai semua antrian sebagai selesai?')) return;
            
            try {
                const snapshot = await db.collection('queue')
                    .where('status', 'in', ['waiting', 'called'])
                    .get();
                
                const batch = db.batch();
                snapshot.forEach(doc => {
                    batch.update(doc.ref, {
                        status: 'done',
                        completedAt: new Date()
                    });
                });
                
                await batch.commit();
                showNotification('Semua antrian ditandai selesai', 'success');
            } catch (error) {
                console.error('Error marking all as done:', error);
                showNotification('Gagal menandai antrian', 'error');
            }
        }

        async function callNextQueueAdmin() {
            try {
                // Find next waiting queue
                const snapshot = await db.collection('queue')
                    .where('status', '==', 'waiting')
                    .orderBy('createdAt')
                    .limit(1)
                    .get();
                
                if (snapshot.empty) {
                    showNotification('Tidak ada antrian menunggu', 'info');
                    return;
                }
                
                const queueDoc = snapshot.docs[0];
                await callQueue(queueDoc.id);
            } catch (error) {
                console.error('Error calling next queue:', error);
                showNotification('Gagal memanggil antrian berikutnya', 'error');
            }
        }

        // Order CRUD Functions
        async function viewOrderDetail(orderId) {
            try {
                const doc = await db.collection('orders').doc(orderId).get();
                
                if (!doc.exists) {
                    showNotification('Order tidak ditemukan', 'error');
                    return;
                }
                
                const order = doc.data();
                let itemsHTML = '';
                
                if (order.items && order.items.length > 0) {
                    order.items.forEach(item => {
                        itemsHTML += `
                            <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                <div>
                                    <p class="font-medium">${item.name}</p>
                                    <p class="text-sm text-gray-500">${item.quantity} x ${formatRupiah(item.price)}</p>
                                </div>
                                <p class="font-medium">${formatRupiah(item.price * item.quantity)}</p>
                            </div>
                        `;
                    });
                }
                
                const content = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500">Order ID</p>
                                <p class="font-medium">${orderId}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">No Antrian</p>
                                <p class="font-medium">${order.queueNumber || 'N/A'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Tanggal</p>
                                <p class="font-medium">${order.timestamp ? order.timestamp.toDate().toLocaleString('id-ID') : 'N/A'}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Status</p>
                                <p class="font-medium">
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                        order.status === 'waiting' ? 'bg-yellow-100 text-yellow-800' :
                                        order.status === 'in-progress' ? 'bg-blue-100 text-blue-800' :
                                        'bg-green-100 text-green-800'
                                    }">
                                        ${getStatusText(order.status)}
                                    </span>
                                </p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold text-gray-900 mb-3">Items</h4>
                            ${itemsHTML || '<p class="text-gray-500">Tidak ada items</p>'}
                        </div>
                        
                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex justify-between items-center">
                                <p class="text-lg font-bold text-gray-900">Total</p>
                                <p class="text-2xl font-bold text-amber-700">${formatRupiah(order.total || 0)}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('orderDetailContent').innerHTML = content;
                document.getElementById('orderDetailModal').classList.remove('hidden');
            } catch (error) {
                console.error('Error viewing order detail:', error);
                showNotification('Gagal memuat detail order', 'error');
            }
        }

        async function updateOrderStatus(orderId) {
            const currentDoc = await db.collection('orders').doc(orderId).get();
            if (!currentDoc.exists) return;
            
            const currentStatus = currentDoc.data().status;
            const statusOptions = ['waiting', 'in-progress', 'done'];
            const currentIndex = statusOptions.indexOf(currentStatus);
            const nextIndex = (currentIndex + 1) % statusOptions.length;
            const nextStatus = statusOptions[nextIndex];
            
            try {
                await db.collection('orders').doc(orderId).update({
                    status: nextStatus,
                    updatedAt: new Date()
                });
                
                showNotification(`Status order diubah menjadi ${getStatusText(nextStatus)}`, 'success');
            } catch (error) {
                console.error('Error updating order status:', error);
                showNotification('Gagal mengubah status order', 'error');
            }
        }

        async function deleteOrder(orderId) {
            if (!confirm('Apakah Anda yakin ingin menghapus order ini?')) return;
            
            try {
                await db.collection('orders').doc(orderId).delete();
                showNotification('Order berhasil dihapus', 'success');
            } catch (error) {
                console.error('Error deleting order:', error);
                showNotification('Gagal menghapus order', 'error');
            }
        }

        // Queue management functions
        async function clearCompletedQueue() {
            if (!confirm('Hapus semua antrian yang sudah selesai?')) return;
            
            try {
                const snapshot = await db.collection('queue')
                    .where('status', '==', 'done')
                    .get();
                
                const batch = db.batch();
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                showNotification('Antrian selesai berhasil dihapus', 'success');
            } catch (error) {
                console.error('Error clearing completed queue:', error);
                showNotification('Gagal menghapus antrian selesai', 'error');
            }
        }

        async function resetTodayQueue() {
            if (!confirm('Reset semua antrian hari ini? Ini akan menghapus semua antrian.')) return;
            
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const snapshot = await db.collection('queue').get();
                
                const batch = db.batch();
                snapshot.forEach(doc => {
                    const queueDate = doc.data().createdAt.toDate();
                    if (queueDate >= today) {
                        batch.delete(doc.ref);
                    }
                });
                
                await batch.commit();
                showNotification('Antrian hari ini berhasil direset', 'success');
            } catch (error) {
                console.error('Error resetting today queue:', error);
                showNotification('Gagal reset antrian', 'error');
            }
        }

        // Test functions
        function testVoiceAnnouncement() {
            if ('speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance('Test suara: Antrian nomor 1 silakan ke kasir');
                speech.lang = 'id-ID';
                speech.rate = 1;
                speech.pitch = 1;
                speech.volume = 1;
                window.speechSynthesis.speak(speech);
                showNotification('Test suara berjalan', 'success');
            } else {
                showNotification('Browser tidak mendukung text-to-speech', 'error');
            }
        }

        async function announceQueueNumber(queueId) {
            try {
                const doc = await db.collection('queue').doc(queueId).get();
                if (!doc.exists) return;
                
                const queue = doc.data();
                
                if ('speechSynthesis' in window) {
                    const speech = new SpeechSynthesisUtterance(
                        `Antrian nomor ${queue.queueNumber} silakan ke kasir`
                    );
                    speech.lang = 'id-ID';
                    speech.rate = 1;
                    speech.pitch = 1;
                    speech.volume = 1;
                    window.speechSynthesis.speak(speech);
                }
            } catch (error) {
                console.error('Error announcing queue:', error);
            }
        }

        // Report functions
        async function loadReportsData() {
            try {
                const period = document.getElementById('reportPeriod').value;
                const now = new Date();
                let startDate = new Date();
                
                switch(period) {
                    case 'today':
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'week':
                        startDate.setDate(now.getDate() - 7);
                        break;
                    case 'month':
                        startDate.setMonth(now.getMonth() - 1);
                        break;
                    case 'all':
                        startDate = new Date(0); // Beginning of time
                        break;
                }
                
                // Load orders for period
                const ordersSnapshot = await db.collection('orders')
                    .where('timestamp', '>=', startDate)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                // Load queue for period
                const queueSnapshot = await db.collection('queue')
                    .where('createdAt', '>=', startDate)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                // Calculate sales summary
                let totalOrders = 0;
                let totalRevenue = 0;
                const productSales = {};
                
                ordersSnapshot.forEach(doc => {
                    const order = doc.data();
                    totalOrders++;
                    totalRevenue += order.total || 0;
                    
                    // Track product sales
                    if (order.items) {
                        order.items.forEach(item => {
                            if (!productSales[item.name]) {
                                productSales[item.name] = 0;
                            }
                            productSales[item.name] += item.quantity;
                        });
                    }
                });
                
                // Calculate queue stats
                let totalQueue = 0;
                let waitingTimeTotal = 0;
                let maxQueueNumber = 0;
                let completedQueue = 0;
                
                queueSnapshot.forEach(doc => {
                    const queue = doc.data();
                    totalQueue++;
                    
                    if (queue.queueNumber) {
                        const queueNum = parseInt(queue.queueNumber.replace('Q', '')) || 0;
                        if (queueNum > maxQueueNumber) {
                            maxQueueNumber = queueNum;
                        }
                    }
                    
                    if (queue.status === 'done' && queue.createdAt && queue.completedAt) {
                        const created = queue.createdAt.toDate();
                        const completed = queue.completedAt.toDate();
                        const waitTime = (completed - created) / (1000 * 60); // minutes
                        waitingTimeTotal += waitTime;
                        completedQueue++;
                    }
                });
                
                // Find best seller
                let bestSeller = '-';
                let maxSales = 0;
                for (const [product, sales] of Object.entries(productSales)) {
                    if (sales > maxSales) {
                        maxSales = sales;
                        bestSeller = product;
                    }
                }
                
                // Update report UI
                document.getElementById('reportTotalOrders').textContent = totalOrders;
                document.getElementById('reportTotalRevenue').textContent = formatRupiah(totalRevenue);
                document.getElementById('reportAvgOrder').textContent = formatRupiah(totalOrders > 0 ? totalRevenue / totalOrders : 0);
                document.getElementById('reportBestSeller').textContent = bestSeller;
                
                document.getElementById('reportTotalQueue').textContent = totalQueue;
                document.getElementById('reportAvgWaitTime').textContent = completedQueue > 0 ? 
                    Math.round(waitingTimeTotal / completedQueue) + ' menit' : '0 menit';
                document.getElementById('reportMaxQueue').textContent = maxQueueNumber;
                document.getElementById('reportEfficiency').textContent = totalQueue > 0 ? 
                    Math.round((completedQueue / totalQueue) * 100) + '%' : '0%';
                
                // Update report orders table
                let reportOrdersHTML = '';
                ordersSnapshot.forEach((doc, index) => {
                    if (index >= 10) return; // Limit to 10 recent orders
                    
                    const order = doc.data();
                    reportOrdersHTML += `
                        <tr class="border-b border-gray-100">
                            <td class="py-2">
                                <span class="text-sm font-mono">${doc.id.substring(0, 8)}...</span>
                            </td>
                            <td class="py-2">
                                <span class="text-xs text-gray-500">${formatTime(order.timestamp)}</span>
                            </td>
                            <td class="py-2">
                                <span class="text-sm">${order.items ? order.items.length : 0} items</span>
                            </td>
                            <td class="py-2">
                                <span class="font-medium">${formatRupiah(order.total || 0)}</span>
                            </td>
                            <td class="py-2">
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                    order.status === 'waiting' ? 'bg-yellow-100 text-yellow-800' :
                                    order.status === 'in-progress' ? 'bg-blue-100 text-blue-800' :
                                    'bg-green-100 text-green-800'
                                }">
                                    ${getStatusText(order.status)}
                                </span>
                            </td>
                        </tr>
                    `;
                });
                
                const reportOrdersTable = document.getElementById('reportOrdersTable');
                if (reportOrdersHTML) {
                    reportOrdersTable.innerHTML = reportOrdersHTML;
                } else {
                    reportOrdersTable.innerHTML = `
                        <tr>
                            <td colspan="5" class="py-6 text-center text-gray-400">
                                Tidak ada data order
                            </td>
                        </tr>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading report data:', error);
                showNotification('Gagal memuat data laporan', 'error');
            }
        }

        function exportReport() {
            // Simple export to JSON
            const period = document.getElementById('reportPeriod').value;
            const reportData = {
                period: period,
                generatedAt: new Date().toISOString(),
                salesSummary: {
                    totalOrders: document.getElementById('reportTotalOrders').textContent,
                    totalRevenue: document.getElementById('reportTotalRevenue').textContent,
                    avgOrder: document.getElementById('reportAvgOrder').textContent,
                    bestSeller: document.getElementById('reportBestSeller').textContent
                },
                queueStats: {
                    totalQueue: document.getElementById('reportTotalQueue').textContent,
                    avgWaitTime: document.getElementById('reportAvgWaitTime').textContent,
                    maxQueue: document.getElementById('reportMaxQueue').textContent,
                    efficiency: document.getElementById('reportEfficiency').textContent
                }
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `vlcafe-report-${period}-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Laporan berhasil diexport', 'success');
        }

        function generateReport() {
            showPage('reports');
            showNotification('Laporan sedang dibuat...', 'info');
            setTimeout(loadReportsData, 1000);
        }

        // Page data loading
        function loadDashboardData() {
            // Already handled by real-time listeners
        }

        function loadQueueData() {
            // Already handled by real-time listeners
        }

        function loadOrdersData() {
            // Already handled by real-time listeners
        }

        function loadProductsData() {
            // Already handled by real-time listeners
        }

        function loadReportsData() {
            // Implemented above
        }

        // Logout
        async function logout() {
            try {
                // Unsubscribe from all listeners
                unsubscribeFunctions.forEach(unsub => unsub());
                unsubscribeFunctions = [];
                
                await auth.signOut();
                currentUser = null;
                
                // Reset UI
                mainLayout.classList.add('hidden');
                loginModal.classList.remove('hidden');
                
                showNotification('Logout berhasil', 'info');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Logout gagal', 'error');
            }
        }

        // Test Firebase Connection
        async function testFirebaseConnection() {
            try {
                if (!firebaseInitialized) {
                    alert('Firebase belum diinisialisasi');
                    return;
                }
                
                const testDoc = await db.collection('test').doc('connection').get();
                alert('Koneksi Firebase berhasil!');
            } catch (error) {
                alert('Koneksi Firebase gagal: ' + error.message);
            }
        }

        function closeFirestoreTest() {
            document.getElementById('firestoreTestModal').classList.add('hidden');
        }

        function closeOrderDetailModal() {
            document.getElementById('orderDetailModal').classList.add('hidden');
        }

        // Initialize event listeners for report period change
        document.getElementById('reportPeriod').addEventListener('change', loadReportsData);
        document.getElementById('orderFilter').addEventListener('change', loadOrdersData);
        document.getElementById('searchOrder').addEventListener('input', function(e) {
            // Implement search functionality
            const searchTerm = e.target.value.toLowerCase();
            // Filter orders based on search term
        });

        // Make functions available globally
        window.showPage = showPage;
        window.testFirebaseConnection = testFirebaseConnection;
        window.closeFirestoreTest = closeFirestoreTest;
        window.clearCompletedQueue = clearCompletedQueue;
        window.resetTodayQueue = resetTodayQueue;
        window.generateReport = generateReport;
        window.exportReport = exportReport;
        window.showAddProductModal = showAddProductModal;
        window.closeProductModal = closeProductModal;
        window.saveProduct = saveProduct;
        window.testVoiceAnnouncement = testVoiceAnnouncement;
        window.callNextQueueAdmin = callNextQueueAdmin;
        window.callQueue = callQueue;
        window.markQueueAsDone = markQueueAsDone;
        window.deleteQueue = deleteQueue;
        window.markAllAsDone = markAllAsDone;
        window.viewOrderDetail = viewOrderDetail;
        window.closeOrderDetailModal = closeOrderDetailModal;
        window.updateOrderStatus = updateOrderStatus;
        window.deleteOrder = deleteOrder;
        window.editProduct = editProduct;
        window.toggleProductAvailability = toggleProductAvailability;
        window.deleteProduct = deleteProduct;

    </script>
</body>
</html>
